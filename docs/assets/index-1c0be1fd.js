import{i as z,r as g,c as x,j as F,k as M,l as O,m as U}from"./index-b2a37ce1.js";const _={width:{type:Number,default:500},height:{type:Number,default:200},canvasStyle:{type:Object,default:()=>({border:"2px solid #6699cc"})},color:{default:"#000"},lineWidth:{type:String||Number,default:"10"},defaultImg:{type:String,default:""},empty:{type:String,default:"签名区域"},isEraser:{type:Boolean,default:!1},eraserSize:{type:Number,default:25}},j=z({props:_,name:"elesign",setup(t,{expose:d}){const v=U();let o=!1,c=null,y=null,e=null,n=null;const i=g(!0);let m=!1,l=g([]),r=g(l.value.length-1);function w(){i.value=!0,e.font="40px Arial",e.fillStyle="#aaa",e.textAlign="center",e.textBaseline="middle",e.fillText(t.empty,parseFloat(t.width)/2,parseFloat(t.height)/2)}function C(){i.value=!1,e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height)}function D(){if(n=v.refs.myCanvas,e=n.getContext("2d"),n.addEventListener("mousedown",E),n.addEventListener("mousemove",b),n.addEventListener("mouseup",f),n.addEventListener("mouseleave",f),t.defaultImg){i.value=!1;let a=new Image;a.src=t.defaultImg,a.onload=function(){e.drawImage(a,0,0)}}else w()}function E(a){o=!0,L(a,!1)}function b(a){o&&L(a,!0)}function f(){o=!1,m&&(m=!1,p())}function p(){l.value=l.value.slice(0,r.value+1);let a=S();(!l.value.length||l.value.indexOf(a)!==l.value.length-1)&&l.value.push(a),r.value=l.value.length-1}function I(){e.clearRect(0,0,e.canvas.width,e.canvas.height);let a=new Image;a.src=l.value[r.value],a.onload=function(){e.drawImage(a,0,0)}}function P(){r.value<0||(r.value--,I())}function T(){r.value>=l.value.length-1||(r.value++,I())}const k=x(()=>r.value>=0),A=x(()=>r.value<l.value.length-1);function L(a,h){let s=a.pageX-n.offsetLeft,u=a.pageY-n.offsetTop;if(m=!0,h){if(t.isEraser){R(a,s,u);return}if(e.beginPath(),typeof t.color=="string")e.strokeStyle=t.color;else{t.color.setAttribute("crossOrigin","Anonymous");let N=e.createPattern(t.color,"repeat");e.strokeStyle=N}e.lineWidth=t.lineWidth,e.lineJoin="round",e.lineCap="round",e.moveTo(c,y),e.lineTo(s,u),e.closePath(),e.stroke(),i.value&&C()}c=s,y=u}function R(a,h,s){e.save(),e.beginPath();let u=t.eraserSize;e.arc(h,s,u/2,0,Math.PI*2,!1),e.clip(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}function W(){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),w(),p()}function S(){return n.toDataURL("image/png")}function B(){e=null,n.removeEventListener("mousedown",E),n.removeEventListener("mousemove",b),n.removeEventListener("mouseup",f),n.removeEventListener("mouseleave",f)}return d({redo:W,toPng:S,isEmpty:i,backward:P,forward:T,isBackwardAble:k,isForwardAble:A}),F(()=>{D()}),M(()=>{B()}),()=>O("canvas",{ref:"myCanvas",width:t.width,height:t.height,style:t.canvasStyle})}}),H=/-(\w)/g;function X(t){return t.install=d=>{let v=t.name||t._name;d.component(`-${v}`.replace(H,(o,c)=>c.toUpperCase()),t)},t}const J=X(j);export{J as e};
